<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Git hook for static sites hosted on S3 &middot; Vinay Hiremath</title>

		
  		<link rel="stylesheet" href="/blog/css/style.css">
		<link rel="stylesheet" href="/blog/css/fonts.css">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Vinay Hiremath" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/blog/">
					<h2 class="nav-title">Vinay Hiremath</h2>
				</a>
				<ul>
    
    
        <li>
            <a href="/blog/categories/daily">
                
                <span>Daily</span>
                
            </a>
        </li>
    
        <li>
            <a href="/blog/tags/">
                
                <span>Tags</span>
                
            </a>
        </li>
    
        <li>
            <a href="https://vinayh.com">
                
                <span>Main site</span>
                
            </a>
        </li>
    
        <li>
            <a href="/blog/about/">
                
                <span>About me</span>
                
            </a>
        </li>
    
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        Vinay Hiremath
        <br>
        <span>on&nbsp;</span><time datetime="2015-07-28 14:49:41 -0400 -0400">July 28, 2015</time>
</div>
		<h1 class="post-title">Git hook for static sites hosted on S3</h1>
<div class="post-line"></div>

		

		<p>It&rsquo;s a surprisingly simple process to setup S3 syncing with a static site generator with source that you sync using Git. This will allow you to track revision history on your actual writing of posts, etc. while having the generated site automatically deployed on S3 on each push.</p>
<p>All you really need is:</p>
<ol>
<li>A way to upload a folder to S3 (I use the excellent <code>s3cmd</code>)</li>
<li>A hook that triggers the upload on every <code>git push</code></li>
</ol>
<p>For example, if your static site generator is <code>hugo</code>, with destination dir <code>public</code> (like Hugo by default) and your S3 bucket is called <code>&lt;example_bucket&gt;</code>, create a new shell script called <code>pre-push</code> in the <code>.git/hooks</code> directory of your site source as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>set -e
echo -e <span style="color:#e6db74">&#34;\t Building site...&#34;</span>
hugo
echo -e <span style="color:#e6db74">&#34;\t Successfully generated site&#34;</span>
s3cmd sync --recursive public/ s3://&lt;example_bucket&gt;
echo -e <span style="color:#e6db74">&#34;\t Successfully deployed to S3&#34;</span>
</code></pre></div><p>Mark the script as executable using <code>chmod +x .git/hooks/pre-push</code> and try pushing to your Git server. If everything goes well, <code>s3cmd</code> will automatically be triggered and will perform a <code>sync</code> operation to upload changed files to S3. Assuming you have your S3 settings configured for a public web server (static website hosting is enabled, index and error documents are set correctly, public read access is permitted) then you should be able to see the contents of your <code>public</code> dir (ie. your website) at the URL assigned to your bucket.</p>
<p>Note: This S3 bucket policy will enable public read access:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;Statement&#34;</span>: [
		{
			<span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;AllowPublicRead&#34;</span>,
			<span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
			<span style="color:#f92672">&#34;Principal&#34;</span>: {
				<span style="color:#f92672">&#34;AWS&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
			},
			<span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
			<span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::&lt;example_bucket&gt;/*&#34;</span>
		}
	]
}
</code></pre></div><p>Courtesy of a blog post by <a href="https://moosingin3space.github.io">Nathan Moos</a> outlining this process for GitHub Pages, which requires a nested repository with your public files.</p>


		
	</div>

	<div class="pagination">
		<a href="/blog/about/" class="left arrow">&#8592;</a>
		<a href="/blog/post/clojure-web-dev/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
                    &copy; <time datetime="2020-03-22 16:39:16.233525729 &#43;0100 CET m=&#43;0.065742682">2020</time> Vinay Hiremath <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
